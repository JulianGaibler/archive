---
import Button from 'tint/components/Button.svelte'

import HeaderMenu from './HeaderMenu.svelte'

const { signedIn, me, error } = Astro.locals.me
---

<header>
  <div>
    <a href="/"><h1>Archive</h1></a>
  </div>
  <div>
    {
      error || Astro.isPrerendered ? null : signedIn ? (
        <HeaderMenu client:idle user={me?.data.me} />
      ) : (
        <Button small={true} href="/login">
          Log in
        </Button>
      )
    }
  </div>
</header>

<script>
  let ticking = false
  function checkHeaderScroll() {
    const header = document.querySelector('header')
    if (header) {
      if (window.scrollY > 10) {
        header.classList.add('scrolled')
      } else {
        header.classList.remove('scrolled')
      }
    }
  }
  function onScroll() {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        checkHeaderScroll()
        ticking = false
      })
      ticking = true
    }
  }
  window.addEventListener('scroll', onScroll, { passive: true })
  checkHeaderScroll()
</script>

<style lang="sass">
  header
    display: flex
    justify-content: space-between
    align-items: center
    height: 72px
    padding-inline: tint.$size-24
    background-color: var(--tint-bg)
    @media (max-width: tint.$breakpoint-md)
      position: sticky
      top: 0
      z-index: 1000
      background: linear-gradient(#ffffff, #ffffff00)
      transition: box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out
      &.scrolled
        box-shadow: var(--tint-card-shadow), inset 0 -1px 0px 0px #0000000f
        // set to 90% opacity and set background blur
        background-color: rgba(255, 255, 255, 0.8)
        backdrop-filter: blur(8px)

  a
    text-decoration: none
    &:hover, &:active
      text-decoration: underline
  h1
    font-family: 'HK Grotesk', sans-serif
    font-size: tint.$size-24
    font-weight: 700
</style>
